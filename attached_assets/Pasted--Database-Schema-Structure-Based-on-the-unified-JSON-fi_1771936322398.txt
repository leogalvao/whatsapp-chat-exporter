 Database Schema Structure

  Based on the unified JSON files (Combined_Messages.json, _dispatches.json, and metrics_report.json),
  here is the recommended logical schema:

  1. Chats / Crews (exportInfo)
  Represents the top-level metadata for each group chat (crew).
   * `chatName` (String): The name of the crew or group (e.g., "George parking lots"). Primary Key.
   * `totalMessages` (Integer): The recalculated total number of unique messages.
   * `totalMedia` (Integer): The recalculated total number of unique media files.

  2. Messages (messages array)
  Represents individual chat messages tied to a specific chatName.
   * `id` (String): Unique identifier for the message. Primary Key.
   * `chatName` (String): Foreign key linking back to the Chat/Crew.
   * `type` (String): Type of message ("text", "image", etc.).
   * `content` (String): The text payload of the message.
   * `dateTime` (DateTime): ISO format datetime string.
   * `date` (String): Extracted date format ("YYYY-MM-DD").
   * `timestamp` (String): Extracted time format ("HH:MM:SS").
   * `sender` (String): The name or phone number of the sender.

  3. Media Files (mediaFiles array)
  Tracks individual attachments, linked to their parent messages.
   * `messageId` (String): The unique ID linking back to the id in the Messages table. Primary Key /
     Foreign Key.
   * `type` (String): Type of media ("image", "video", etc.).
   * `filename` (String): The original name of the file.

  4. Dispatches (_dispatches.json)
  Handles the image-to-text correlation generated by the OCR script.
   * `crew` (String): The name of the group. Foreign key to Chats.
   * `image_path` (String): Relative path to the image file.
   * `matched_message` (String): The text content of the message that best matches the image text.
   * `message_timestamp` (DateTime): The timestamp of the matched text message.
   * `ocr_snippet` (String): A truncated snippet (up to 200 chars) of the text extracted from the image.
   * `confidence` (Float): Similarity score between the OCR text and the chat message (0.0 to 1.0).

  5. Metrics Summary (metrics_report.json -> summary)
  High-level operational overview across all crews. 
   * `generated_at` (DateTime): Timestamp of when the report was run.
   * `total_messages` (Integer): Total raw messages parsed.
   * `clean_messages` (Integer): Total messages classified as operational/clean.
   * `noise_messages` (Integer): Total messages classified as irrelevant/noise.
   * `active_crews` (Integer): Count of unique crews active in the timeframe.
   * `total_sites_visited` (Integer): Global count of distinct location visits.
   * `avg_sites_per_hour` (Float): Global average of site clearings per active hour.
   * `avg_first_report` (String): Average clock time for the first daily message.
   * `avg_transition_min` (Float): Global average travel/gap time between sites.

  6. Crew Metrics (metrics_report.json -> crew_metrics)
  Aggregate performance metrics rolled up by specific crew.
   * `crew` (String): Name of the crew. Foreign key to Chats.
   * `days_active` (Integer): Number of distinct calendar days the crew sent messages.
   * `total_sites` (Integer): Total locations visited across all days.
   * `avg_sites_per_day` (Float): Average locations cleared per active day.
   * `avg_sites_per_hour` (Float): Average locations cleared per worked hour.
   * `avg_transition_min` (Float): Average downtime/travel time in minutes.
   * `total_active_hrs` (Float): Total hours calculated from first to last message across all days.

  7. Daily Breakdown (metrics_report.json -> daily_breakdown)
  Crew performance separated by individual work shifts/days.
   * `crew` (String): Name of the crew. Foreign Key.
   * `date` (String): The specific workday ("YYYY-MM-DD").
   * `first_report` (String): Timestamp of the day's first message.
   * `last_report` (String): Timestamp of the day's last message.
   * `window_hrs` (Float): Shift duration (hours between first and last report).
   * `messages` (Integer): Total messages sent by the crew on this day.
   * `avg_gap_min` (Float): Average minutes between consecutive messages on this day.

  8. Productivity Scores (metrics_report.json -> productivity_scores)
  Algorithmic scoring system representing a crew's efficiency on a given day.
   * `crew` (String): Name of the crew. Foreign Key.
   * `date` (String): The specific workday.
   * `productivity_score` (Float): Overall calculated score out of 100.
   * `pace_score` (Float): Score representing speed of site clearings.
   * `punctuality_score` (Float): Score based on the expected start time (e.g., first_report).
   * `coverage_score` (Float): Score based on shift longevity or site volume.
   * `sites_visited` (Integer): Count of unique locations on this day.
   * `sites_per_hour` (Float): Rate of clearings for this specific shift.

  9. Site Visits (metrics_report.json -> site_visits)
  Granular logs of specific locations visited by a crew.
   * `crew` (String): Name of the crew. Foreign Key.
   * `date` (String): The specific workday.
   * `location` (String): Extracted address/name of the site.
   * `start_time` (String): Timestamp of the first message mentioning/at this site.
   * `end_time` (String): Timestamp of the last message mentioning/at this site.
   * `duration_min` (Float): Total minutes spent at the location.
   * `messages` (Integer): Number of messages sent while at this location.

  ---

  Assumptions and Logic Used for Processing & Metrics

  The generation of these files relies on the following assumptions:

  1. Deduplication & Unification (Combined_Messages)
   * Global Uniqueness: The id string generated by the chat export represents a globally unique message
     event. Re-exports and fragment overlaps are safely resolved by deduplicating against this ID.
   * Media-to-Message Linkage: The messageId attached to media metadata natively and reliably maps 1:1 to
     a parent text/system message. 
   * Image File Identity (SHA-256): If two image files yield the exact same SHA-256 hash, they are assumed
     to be exact binary copies, and all but one are physically deleted to save disk space.

  2. OCR and Dispatch Correlation (_dispatches.json)
   * Visual Dispatch Definition: Any image containing more than 20 distinct, recognized text characters
     via Tesseract OCR is assumed to be a dispatch order, table, or screenshot rather than a standard
     photograph.
   * Fuzzy Correlative Logic: A Sequence Matcher algorithm assumes that if the text in the image and the
     text in a chat message share a similarity ratio > 0.15 (15%), they are describing the same dispatch
     event. 
   * Direct Substring Exemption: If a shorter text message is found verbatim within a larger block of
     image text, the script assumes a direct structural link and artificially guarantees a match
     (confidence bumped to >80%).

  3. Operational Metrics (metrics_report.json)
   * Shift Definition: A crew's "workday" (window_hrs) is assumed to be strictly defined by the time
     elapsed between their very first message on a calendar date and their very last message on that same
     calendar date. 
   * Transitions / Gaps: The time between any two consecutive messages is treated as either active work
     (if at the same site) or a "transition" (if moving to a new site). Extended silences drastically
     increase the avg_gap_min or avg_transition_min.
   * Message Classification: A "clean" message is assumed to contain actionable operational data (times,
     addresses, photos of work). A "noise" message is assumed to be conversational filler, errors, or
     system messages that do not indicate work progress.
   * Site Identification Logic: Locations (site_visits) are assumed to be identified by parsing messages
     for address-like string patterns (e.g., street numbers followed by "st", "ave", "nw", etc.) or
     specific recognized landmarks. The duration spent at a site is bounded by the first and last messages
     correlated to that parsed address before the crew moves on to a new address.
